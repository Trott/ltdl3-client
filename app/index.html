<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>LTDL3 Client</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

        <!-- build:css styles/main.css -->
        <link rel="stylesheet" href="styles/main.css">
        <!-- endbuild-->

        <script src="bower_components/react/react.min.js"></script>
        <script src="bower_components/jquery/dist/jquery.min.js"></script>
        <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    </head>
    <body>
        <div id="content">
        </div>

        <script src="scripts/githubRibbon.js"></script>
        <script src="scripts/searchBuilderTextBox.js"></script>
        <script src="scripts/searchBuilderFilterType.js"></script>
        <script src="scripts/searchBuilderFilterPhrase.js"></script>
        <script src="scripts/searchBuilderComponent.js"></script>
        <script src="scripts/searchBuilder.js"></script>
        <script src="scripts/footer.js"></script>
        <script src="scripts/app.js"></script>
        <script>
            // TODO: Inline script. No no no no no. (Well, yes yes yes after a build process perhaps.)
            var focusSearchBox = function () {
                $(this).parents('.ltdl-search-builder-component').find('.ltdl-search-box').focus();
            }

            var filterWhatCallback = function () {
                var text = $(this).attr('data-ltdl-text');
                if (typeof text !== "string") {
                    text = $(this).text();
                }
                $(this).parents('.ltdl-search-builder-component').find('button.ltdl-filter-what').html(text + ' <span class="caret"></span>');
                focusSearchBox.apply(this);
            };

            var filterWhatToSearchBoxCallback = function () {
                $(this).parents('.ltdl-search-builder-component').find('.ltdl-search-box').val($(this).text());
                // TODO: parent().parent().parent()? We can do better than that.
                $(this).parents('.ltdl-search-builder-component').find('button.ltdl-filter-what').html($(this).parent().parent().parent().find('.hoist-to-button').text() + ' <span class="caret"></span>');
                focusSearchBox.apply(this);
            }

            // TODO: Big long DOM string, no no no.
            // TODO: classes sometimes prepended with ltdl- but not always. Make it always.
            var addSearchBuilderComponent = function (event) {
                $(newSearchBuilderComponent).find('.show-in-button').on('click', filterWhatCallback);
                $(newSearchBuilderComponent).find('.show-in-search-box').on('click', filterWhatToSearchBoxCallback);

                $(newSearchBuilderComponent).find('.ltdl-search-add').one('click', addSearchBuilderComponent);

                $('#ltdl-search-builder').append(newSearchBuilderComponent);
                $('#ltdl-search-builder input').focus();

                var booleanCallback = function () {
                    $(this).parents('.ltdl-search-builder-component').find('.ltdl-search-builder-boolean').html($(this).text() + ' <span class="caret"></span>');
                };

                var minus = $('<div class="input-group-btn"><button type="button" class="btn btn-default dropdown-toggle ltdl-search-builder-boolean" data-toggle="dropdown">' + $(this).text() + ' <span class="caret"></span></button>' +
                    '<ul class="dropdown-menu dropdown-menu-right" role="menu">' +
                    '<li class="ltdl-search-builder-boolean-dropdown"><a href="#">AND</a></li>' +
                    '<li class="ltdl-search-builder-boolean-dropdown"><a href="#">OR</a></li>' +
                    '<li class="ltdl-search-builder-boolean-dropdown"><a href="#">NOT</a></li>' +
                    '</ul><button type="button" class="btn btn-default ltdl-search-minus"><span class="glyphicon glyphicon-minus"></span></button></div>');
                $(this).parents('.ltdl-search-builder-component').find('.ltdl-search-plus').replaceWith(minus);
                minus.find('.ltdl-search-minus').one('click', function () {
                    $(this).parents('.ltdl-search-builder-component').remove();
                });
                minus.find('.ltdl-search-builder-boolean-dropdown').on('click', booleanCallback);
            };
        </script>
    </body>
</html>
